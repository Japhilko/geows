<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Nutzung von Geodaten in den Sozialwissenschaften</title>
    <meta charset="utf-8" />
    <meta name="author" content="Jan-Philipp Kolb" />
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/default-fonts.css" rel="stylesheet" />
    <link rel="stylesheet" href="..\workshop.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Nutzung von Geodaten in den Sozialwissenschaften
## Das tmap Paket
### Jan-Philipp Kolb
### 08 April, 2020

---





## Inhalt dieses Abschnitts

- Das Paket `tmap` wird vorgestellt. 
- Die Datenquelle `naturalearthdata` wird vorgestellt.
- Es wird gezeigt, wie man Karten von Europa, der Welt und einzelnen Ländern erzeugen kann




---


## Das Paket [tmap](https://cran.r-project.org/web/packages/tmap/index.html)

### Thematische Karten

- Mit dem Paket [**tmap**](http://twitter.com/sharon000/status/593028906820599808/photo/1?ref_src=twsrc%5Etfw) kann man thematische Karten erzeugen
- Die olgenden Beispiele basieren auf der [**Vignette**](https://cran.r-project.org/web/packages/tmap/vignettes/tmap-nutshell.html) des Paketes .


```r
install.packages("tmap")
```



```r
library(tmap)
```

---

## Der `World` Datensatz

### Natural Earth

- Datensatz enthält Informationen von  [**Natural Earth**](http://www.naturalearthdata.com/)


```r
data(World)
```

![](figure/NaturalEarthData.PNG)

---

## Der Befehl `qtm` aus dem Paket `tmap`

### Schnelle thematische Karte

- Mit dem Befehl [**qtm**](https://cran.r-project.org/web/packages/tmap/vignettes/tmap-nutshell.html) kann man eine schnelle thematische Karte erzeugen

- Beispiel aus der [**Vignette**](https://cran.r-project.org/web/packages/tmap/vignettes/tmap-nutshell.html) zum Paket `tmap`


```r
qtm(World)
```

![](a2_tmap_files/figure-html/unnamed-chunk-5-1.png)&lt;!-- --&gt;

---


## Der World-Datensatz



```r
head(World)
```

```
## Simple feature collection with 6 features and 15 fields
## geometry type:  MULTIPOLYGON
## dimension:      XY
## bbox:           xmin: -6237303 ymin: -6576291 xmax: 6474206 ymax: 5306915
## epsg (SRID):    NA
## proj4string:    +proj=eck4 +lon_0=0 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs
##   iso_a3                 name           sovereignt     continent
## 1    AFG          Afghanistan          Afghanistan          Asia
## 2    AGO               Angola               Angola        Africa
## 3    ALB              Albania              Albania        Europe
## 4    ARE United Arab Emirates United Arab Emirates          Asia
## 5    ARG            Argentina            Argentina South America
## 6    ARM              Armenia              Armenia          Asia
##                area  pop_est pop_est_dens                   economy
## 1  652860.00 [km^2] 28400000     43.50090 7. Least developed region
## 2 1246700.00 [km^2] 12799293     10.26654 7. Least developed region
## 3   27400.00 [km^2]  3639453    132.82675      6. Developing region
## 4   71252.17 [km^2]  4798491     67.34519      6. Developing region
## 5 2736690.00 [km^2] 40913584     14.95003   5. Emerging region: G20
## 6   28470.00 [km^2]  2967004    104.21510      6. Developing region
##                income_grp gdp_cap_est life_exp well_being footprint inequality
## 1           5. Low income    784.1549   59.668        3.8      0.79  0.4265574
## 2  3. Upper middle income   8617.6635       NA         NA        NA         NA
## 3  4. Lower middle income   5992.6588   77.347        5.5      2.21  0.1651337
## 4 2. High income: nonOECD  38407.9078       NA         NA        NA         NA
## 5  3. Upper middle income  14027.1261   75.927        6.5      3.14  0.1642383
## 6  4. Lower middle income   6326.2469   74.446        4.3      2.23  0.2166481
##        HPI                       geometry
## 1 20.22535 MULTIPOLYGON (((5310471 451...
## 2       NA MULTIPOLYGON (((1531585 -77...
## 3 36.76687 MULTIPOLYGON (((1729835 521...
## 4       NA MULTIPOLYGON (((4675864 313...
## 5 35.19024 MULTIPOLYGON (((-5017766 -6...
## 6 25.66642 MULTIPOLYGON (((3677241 513...
```

---

## Um mehr Farbe in die Karte zu bekommen

### Entwicklungsstand der Wirtschaft

&lt;!--
&lt;http://www.naturalearthdata.com/&gt;
--&gt;

```r
qtm(World, fill="economy")
```

![](a2_tmap_files/figure-html/unnamed-chunk-7-1.png)&lt;!-- --&gt;

---

## Eine Karte mit Text 

### Bevölkerung


```r
qtm(World, fill="pop_est", text="iso_a3")
```

![](a2_tmap_files/figure-html/unnamed-chunk-8-1.png)&lt;!-- --&gt;

---

## Dieses Schema passt besser für [**GDP**](https://en.wikipedia.org/wiki/Population_density)


```r
qtm(World, fill="gdp_cap_est", text="iso_a3", 
    text.size="AREA", root=5, fill.title="GDP per capita")
```

![](a2_tmap_files/figure-html/unnamed-chunk-9-1.png)&lt;!-- --&gt;

---

## Themen des Europa-Datensatzes

### Verfügbare Variablen im Datensatz

- [**ISO Klassifikation**](http://userpage.chemie.fu-berlin.de/diverse/doc/ISO_3166.html)
- Ländername
- Ist das Land Teil Europas? 
- Fläche, Bevölkerung, Bevölkerungsdichte, 
- [**Bruttoinlandsprodukt**](https://en.wikipedia.org/wiki/Gross_domestic_product)
- Bruttoinlandsprodukt [**zu Kaufkraftparitäten**](https://en.wikipedia.org/wiki/List_of_countries_by_GDP_%28PPP%29_per_capita)
- Ökonomie, Einkommensgruppe

---

## Die Variable `continent`


```r
qtm(World, fill="continent")
```

![](a2_tmap_files/figure-html/unnamed-chunk-10-1.png)&lt;!-- --&gt;

---

## Die Variable `area`


```r
qtm(World, fill="area") # Russia is huge
```

![](a2_tmap_files/figure-html/unnamed-chunk-11-1.png)&lt;!-- --&gt;

---

## Bevölkerung


```r
qtm(World, fill="pop_est",fill.title="Population") 
```

![](a2_tmap_files/figure-html/unnamed-chunk-12-1.png)&lt;!-- --&gt;

---

## Ökonomie


```r
qtm(World, fill="economy") 
```

![](a2_tmap_files/figure-html/unnamed-chunk-13-1.png)&lt;!-- --&gt;

---

## Einkommensgruppe


```r
qtm(World, fill="income_grp",fill.title="Income group") 
```

![](a2_tmap_files/figure-html/unnamed-chunk-14-1.png)&lt;!-- --&gt;

---

## Zwei Karten

### Bevölkerung und Entwicklungsstand


```r
tm_shape(World) +
    tm_fill(c("pop_est", "economy"), 
        title=c("Population", "Economy"))
```

![](a2_tmap_files/figure-html/unnamed-chunk-15-1.png)&lt;!-- --&gt;

---

## Welt - Länder nach Einkommensgruppe


```r
qtm(World, fill="income_grp",fill.title="Income group") 
```

![](a2_tmap_files/figure-html/unnamed-chunk-16-1.png)&lt;!-- --&gt;

---

## Ein Datensatz zu den Provinzen in den Niederlanden (R-Paket `tmap`)


```r
data(NLD_prov)
qtm(NLD_prov)
```

![](a2_tmap_files/figure-html/unnamed-chunk-17-1.png)&lt;!-- --&gt;

---

## Niederlande - Bevölkerung in den Provinzen


```r
qtm(NLD_prov, fill="population",fill.title="population") 
```

![](a2_tmap_files/figure-html/unnamed-chunk-18-1.png)&lt;!-- --&gt;


---

## Bevölkerung der Gemeinden in den Niederlanden



```r
data(NLD_muni)
qtm(NLD_muni, fill="population") 
```

![](a2_tmap_files/figure-html/unnamed-chunk-19-1.png)&lt;!-- --&gt;





---

## Weltweite Flächennutzung


```r
data(land)
tm_shape(land,  relative=FALSE) +
    tm_raster("trees", title="Anteil Waldfläche")
```

![](a2_tmap_files/figure-html/unnamed-chunk-21-1.png)&lt;!-- --&gt;

---

## Räumliche Daten zu Metropolregionen


### [UN - World Urbanization Prospects 2018](https://population.un.org/wup/)


```r
data(metro)
head(metro)
```

```
## Simple feature collection with 6 features and 12 fields
## geometry type:  POINT
## dimension:      XY
## bbox:           xmin: -64.18105 ymin: -34.60508 xmax: 69.17246 ymax: 36.7525
## epsg (SRID):    4326
## proj4string:    +proj=longlat +datum=WGS84 +no_defs
##            name             name_long iso_a3 pop1950 pop1960 pop1970 pop1980
## 2         Kabul                 Kabul    AFG  170784  285352  471891  977824
## 8       Algiers El Djazair  (Algiers)    DZA  516450  871636 1281127 1621442
## 13       Luanda                Luanda    AGO  138413  219427  459225  771349
## 16 Buenos Aires          Buenos Aires    ARG 5097612 6597634 8104621 9422362
## 17      Cordoba               Cordoba    ARG  429249  605309  809794 1009521
## 25      Rosario               Rosario    ARG  554483  671349  816230  953491
##     pop1990  pop2000  pop2010  pop2020  pop2030                    geometry
## 2   1549320  2401109  3722320  5721697  8279607   POINT (69.17246 34.52889)
## 8   1797068  2140577  2432023  2835218  3404575     POINT (3.04197 36.7525)
## 13  1390240  2591388  4508434  6836849 10428756   POINT (13.23432 -8.83682)
## 16 10513284 12406780 14245871 15894307 16956491 POINT (-58.40037 -34.60508)
## 17  1200168  1347561  1459268  1562509  1718192  POINT (-64.18105 -31.4135)
## 25  1083819  1152387  1298073  1453814  1606993 POINT (-60.63932 -32.94682)
```

---

## Nur ein Land visualisieren


```r
tm_shape(World[World$name=="Austria", ]) +
    tm_polygons()
```

![](a2_tmap_files/figure-html/unnamed-chunk-23-1.png)&lt;!-- --&gt;

---

## Beispieldaten laden

### Datenquelle Eurostat

- Daten zur Arbeitslosigkeit in Europa 


```r
url &lt;- "https://raw.githubusercontent.com/Japhilko/
GeoData/master/2015/data/Unemployment07a13.csv"

Unemp &lt;- read.csv(url) 
```

---


## Überblick über die Daten


```
##      X  GEO Val2007M12 Val2013M01
## 1 9316 EU28        6.9       10.9
## 2 9325 EU27        6.9       10.9
## 3 9334 EU25        6.9       11.0
## 4 9343 EU15        6.9       11.1
## 5 9352   EA        7.3       12.0
## 6 9361 EA19        7.3       12.0
```


## Exkurs: der Befehl `match`

### Zwei Beispielvektoren erstellen:


```r
vec_a &lt;- c("A",2,6,1,"C")
vec_b &lt;- c(1,"C",2)
```

---

## Die beiden Vektoren zusammen bringen

- Mit der Funktion `match` kann man schauen, welches Element des ersten Vektors sich im zweiten Vektor wiederfindet.


```r
match(vec_a,vec_b)
```

```
## [1] NA  3 NA  1  2
```



## Nutzung des Paketes `tmap` mit eigenen Daten


```r
library("tmap")
data(World)
```

---


## Die Daten matchen


```r
data(World)
iso_a2&lt;- substr(World$iso_a3,1,2)
ind &lt;- match(iso_a2,Unemp$GEO)
World$Val2007M12 &lt;- Unemp$Val2007M12[ind]
World$Val2013M01 &lt;- Unemp$Val2013M01[ind]
```

---

## Eine Karte erzeugen


```r
qtm(World,c("Val2007M12","Val2013M01"))
```

![](a2_tmap_files/figure-html/unnamed-chunk-30-1.png)&lt;!-- --&gt;




---

## Übung: Visualisierung von Eurostat Daten

### Erster Teil

- Verbinde die Statistik zur Sparquote mit den Kartendaten.
- Stelle die Daten in einer Karte dar.

### Zweiter Teil

- Such Daten, in denen der Ländername enthalten ist und versuche diesen Datensatz mit `tmap` zu visualisieren.

---

## Kleine und viele Karten


```r
tm_shape(World) +
    tm_fill("continent", thres.poly = 0) +
    tm_facets("name", free.coords=TRUE)
```

![](a2_tmap_files/figure-html/unnamed-chunk-32-1.png)&lt;!-- --&gt;






---

## Das Paket `tmap` zitieren


```r
citation("tmap")
```

```
## 
## To cite tmap/tmaptools in publications use:
## 
## Tennekes M (2018). "tmap: Thematic Maps in R." _Journal of Statistical
## Software_, *84*(6), 1-39. doi: 10.18637/jss.v084.i06 (URL:
## https://doi.org/10.18637/jss.v084.i06).
## 
## A BibTeX entry for LaTeX users is
## 
##   @Article{,
##     title = {{tmap}: Thematic Maps in {R}},
##     author = {Martijn Tennekes},
##     journal = {Journal of Statistical Software},
##     year = {2018},
##     volume = {84},
##     number = {6},
##     pages = {1--39},
##     doi = {10.18637/jss.v084.i06},
##   }
```
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
